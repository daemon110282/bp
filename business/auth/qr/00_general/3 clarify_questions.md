# Вопросы

## Бизнес‑требования

- Каково точное значение N (максимальное время на завершение авторизации) и связанные SLA?
- Какие KPI считать критичными (процент успешных QR‑логинов, среднее время, p95/p99)?
- Один МП — один аккаунт или поддерживается привязка нескольких аккаунтов к одному МП?
- Требуется ли дополнительная MFA на этапе подтверждения в МП?
- Какова политика логирования, аудит‑требования и сроки хранения событий?
- Какие коды ошибок/поведение должны трактоваться как критические инциденты?

## Пользовательские сценарии

- Что происходит при сканировании QR с другого устройства (разный UA/IP) — разрешено ли?
- Можно ли одновременно сканировать один и тот же QR с двух устройств?
- Какой UX при истёкшем QR (автовосстановление, предложение перегенерировать)?
- Как обрабатывать отмену авторизации в МП и на вебе (отмена со стороны МП, таймаут)?
- Поддерживается ли deeplink без предварительного открытия веб‑страницы; какие варианты deep link требуются?
- Как вести себя при ошибках сети у МП или веба (retry/rollback)?

## Данные

- Точный формат полезной нагрузки QR: поля, JSON‑схема, кодировка (Base64)?
- Какие PII включаются в payload и как они должны маскироваться/шифроваться в логах/БД?
- Какой алгоритм подписи/хэширования обязателен (просто SHA‑256 или HMAC‑SHA256 с ключом)?
- Где хранятся ключи подписи/секреты и каков процесс ротации?
- Нужно ли сохранять qr_token и метаданные в БД; если да — время жизни, индексы, репликация?
- Как формируется uid и гарантия его уникальности/согласованности между сервисами?

## Интеграции

- Какие именно операции Keycloak требуются (Token Exchange, Impersonate, другие) и какие scope/разрешения нужны?
- Требования к CNETS/WebSocket: аутентификация, формат сообщений, схемы событий (init/subscribe/confirm/etc.)?
- Схема deep link в мобильном приложении и ожидаемый payload/путь обработки в МП.
- Требования к интеграции с SIEM/лог‑агрегатором (какие поля, уровни важности)?
- Нужна ли интеграция с SMS/Email при падении основного потока (fallback)?

## Ограничения

- Ограничение по количеству генераций QR для одного пользователя/IP за интервал; поведение при превышении?
- Политики валидации UA и IP: строгая блокировка или эвристическая проверка?
- Требования по идемпотентности (повторный confirm/повторный обмен токенов) — допустимое поведение?
- Ограничения на размер/состав payload для deep link и WS‑сообщений?
- Максимальное число одновременных WSS‑соединений на веб‑сервер и мобильную сторону?

## Риски

- Меры против перехвата/повторного использования QR (защита от replay, скриншотов)?
- План действий при компрометации ключей подписи или сертификатов?
- Риск DoS через массовую генерацию QR или установление WSS‑соединений — лимиты/защиты?
- Что делать при ошибочной авторизации не того аккаунта (ошибка привязки)?
- Оценка риска при различии IP/UA между вебом и МП и допустимые исключения?

## Нефункциональные требования

- Требуемые задержки end‑to‑end, p95/p99 latency для процесса авторизации.
- Ожидаемая нагрузка: QPS на генерацию QR, максимальные конкурентные WSS‑сессии.
- Heartbeat/refresh интервалы для WSS и таймауты для QR (expires_in, reconnect policy).
- Метрики и алерты: какие метрики собирать (401/409/410 rates, auth duration, WS errors)?
- Уровни логирования для прод/стейдж и требования к redaction PII в логах.